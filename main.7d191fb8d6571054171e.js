(self.webpackChunksmart_lamp=self.webpackChunksmart_lamp||[]).push([[179],{376:(e,t,a)=>{"use strict";var n=a(7294),l=a(9060),r=a(1120),c=a(3457),s=a(8129),i=a(1579),m=a(6159),o=a(9702),u=a(7748),d=a(5477),E=a(3832),p=a(5834);const Z=(0,n.createContext)();Z.displayName="ConnectionContext";const g=(0,n.createContext)();g.displayName="ApiContext";const v={ping:async function(e,t){try{return"OK"===(await e(t,{action:"ping"})).error}catch(e){return!1}},geteffects:async function(e,t){try{const a=await e(t,{action:"geteffects"});return"OK"===a.error&&{brightness:+a.brightness,maxbrightness:+a.maxbrightness}}catch(e){return!1}},setbrightness:async function(e,t,a){try{return"OK"===(await e(a,{action:"setbrightness",value:t})).error}catch(e){return!1}}};var h=a(5258),f=a(7812),b=a(8358),w=a(2318),C=a(3375),x=a(739),y=a(5403);const k=(0,r.Z)((e=>({title:{flexGrow:1},save:{marginRight:e.spacing(2)}})));function N({title:e,save:t}){const a=k(),[l]=(0,n.useContext)(Z);return n.createElement(h.Z,{position:"sticky"},n.createElement(b.Z,null,n.createElement(w.Z,{variant:"h6",className:a.title},e||"Светильник"),t?n.createElement(f.Z,{className:a.save,color:"inherit",onClick:t},n.createElement(C.Z,null)):null,l?n.createElement(y.Z,null):n.createElement(x.Z,null)))}var S=a(5881),P=a(8665),I=a(1076),z=a(2832),L=a(9956);const F=(0,r.Z)((e=>({root:{width:"100%",maxWidth:e.breakpoints.values.sm,position:"fixed",bottom:0,zIndex:100}})));function A({page:e,labels:t,setPage:a}){const l=F(),[r]=(0,n.useContext)(Z);return n.createElement(S.Z,{className:l.root,showLabels:!0,value:e,onChange:(e,t)=>{a(t)}},n.createElement(P.Z,{label:t[0],icon:n.createElement(L.Z,null),disabled:!r}),n.createElement(P.Z,{label:t[1],icon:n.createElement(I.Z,null),disabled:!r}),n.createElement(P.Z,{label:t[2],icon:n.createElement(z.Z,null)}))}var O=a(1056),T=a(1201),D=a(743),M=a(3258),W=a(553),_=a(1749),j=a(4845),R=a(6447),B=a(7816),G=a(5352),K=a(4566);const $=(0,r.Z)((e=>({slider:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},icon:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},params:{marginLeft:e.spacing(1),marginRight:e.spacing(1)}})));function H(e,t){return 256*e+t%256}function J(e,t){return 256*Math.floor(t/256)+e}function V({children:e,open:t,value:a}){return n.createElement(R.ZP,{open:t,enterTouchDelay:0,placement:"top",title:a},e)}function q(){const e=$(),[,t]=(0,n.useContext)(Z),a=(0,n.useContext)(g),[l,r]=(0,n.useState)(16),[c,s]=(0,n.useState)(16),[i,m]=(0,n.useState)({index:3,value:20,save:!1}),o=[0,255,192,20,20,-40,4,5,10,1],u=e=>(t,a)=>{m(a?{index:e,value:o[e],save:!0}:{index:0,value:0,save:!0})},d=e=>{m({...i,value:e,save:!1})},E=e=>{m({...i,value:e,save:!0})},p=(0,n.useCallback)((async()=>{const e=await a.geteffects();e?(r(e.brightness),s(e.maxbrightness)):t(!1)}),[a,t]);return(0,n.useEffect)((()=>{i.save&&(async()=>{console.log("save effect: ".concat(i.index,", value: ").concat(Math.abs(i.value))),await a.ping()||t(!1)})()}),[a,t,i]),(0,n.useEffect)((()=>(window.addEventListener("focus",p),p(),()=>{window.removeEventListener("focus",p)})),[p]),n.createElement(n.Fragment,null,n.createElement(_.Z,{container:!0,alignItems:"center",className:e.slider},n.createElement(_.Z,{item:!0,className:e.icon},n.createElement(G.Z,null)),n.createElement(_.Z,{item:!0,xs:!0},n.createElement(j.Z,{min:16,max:c,valueLabelDisplay:"auto",ValueLabelComponent:V,value:l,onChange:(e,t)=>{r(t)},onChangeCommitted:async(e,n)=>{await a.setbrightness(n)||t(!1)}})),n.createElement(_.Z,{item:!0,className:e.icon},n.createElement(B.Z,null))),n.createElement(O.Z,{expanded:1===i.index,onChange:u(1)},n.createElement(D.Z,{expandIcon:n.createElement(K.Z,null)},n.createElement(w.Z,null,"Выбранный цвет")),n.createElement(T.Z,{className:e.params},n.createElement(_.Z,{container:!0,spacing:3},n.createElement(_.Z,{item:!0,xs:12},n.createElement(j.Z,{track:!1,min:0,max:255,value:Math.floor(i.value/256),onChange:(e,t)=>d(H(t,i.value)),onChangeCommitted:(e,t)=>E(H(t,i.value))})),n.createElement(_.Z,{item:!0,xs:12},n.createElement(j.Z,{track:!1,min:0,max:255,value:i.value%256,onChange:(e,t)=>d(J(t,i.value)),onChangeCommitted:(e,t)=>E(J(t,i.value))}))))),[[2,"Цвета по кругу",0,255],[3,"Вертикальная радуга",0,32],[4,"Горизонтальная радуга",0,32],[5,"Матрица",-150,-5],[6,"Вспышки",1,32],[7,"Светлячки",1,16],[8,"Плазма",5,50]].map((t=>n.createElement(O.Z,{key:t[0],expanded:i.index===t[0],onChange:u(t[0])},n.createElement(D.Z,{expandIcon:n.createElement(K.Z,null)},n.createElement(w.Z,null,t[1])),n.createElement(T.Z,{className:e.params},n.createElement(j.Z,{track:!1,min:t[2],max:t[3],value:i.value,onChange:(e,t)=>d(t),onChangeCommitted:(e,t)=>E(t)}))))),n.createElement(O.Z,{expanded:9===i.index,onChange:u(9)},n.createElement(D.Z,{expandIcon:n.createElement(K.Z,null)},n.createElement(w.Z,null,"Огонь")),n.createElement(T.Z,{className:e.params},n.createElement(W.Z,{control:n.createElement(M.Z,{checked:!!i.value,onChange:e=>{m({...i,value:+e.target.checked,save:!0})},color:"primary"}),label:"Искры"}))))}var Q=a(2822),U=a(998),X=a(6869),Y=a(1860),ee=a(5757),te=a(6837),ae=a(9570),ne=a(1411);const le=(0,r.Z)((e=>({alarmField:{background:e.palette.background.paper,width:150},timeField:{background:e.palette.background.paper,width:75}})));function re({setSave:e}){const t=le(),[,a]=(0,n.useContext)(Z),l=(0,n.useContext)(g),[r,c]=(0,n.useState)({enabled:!1,time:"",repeat:0,before:0,after:0}),s=(0,n.useCallback)((async()=>{await l.ping()||a(!1)}),[l,a]);return(0,n.useEffect)((()=>(window.addEventListener("focus",s),s(),()=>{window.removeEventListener("focus",s),e(null)})),[s,e]),n.createElement(Q.Z,null,n.createElement(U.Z,null,n.createElement(X.Z,null,n.createElement(I.Z,null)),n.createElement(ee.Z,{primary:"Будильник включен"}),n.createElement(Y.Z,null,n.createElement(ae.Z,{color:"primary",edge:"end",checked:!0,onChange:()=>{}}))),n.createElement(U.Z,null,n.createElement(ee.Z,{inset:!0,primary:"Время:"}),n.createElement(ne.Z,{id:"alarm-time",type:"time",variant:"outlined",size:"small",className:t.alarmField,inputProps:{step:300},value:"",onChange:e=>{}})),n.createElement(te.Z,null,"Повторять по:"),["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"].map(((e,t)=>n.createElement(U.Z,{dense:!0,button:!0,key:t,onClick:()=>{}},n.createElement(X.Z,null,n.createElement(M.Z,{color:"primary",edge:"start",checked:!0,disableRipple:!0})),n.createElement(ee.Z,{primary:e})))),n.createElement(te.Z,null,"Настройки рассвета (в минутах):"),n.createElement(U.Z,null,n.createElement(ee.Z,{primary:"Рассвет до будильника:"}),n.createElement(Y.Z,null,n.createElement(ne.Z,{id:"time-before",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))),n.createElement(U.Z,null,n.createElement(ee.Z,{primary:"Гореть после будильника:"}),n.createElement(Y.Z,null,n.createElement(ne.Z,{id:"time-after",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))))}var ce=a(282),se=a(4436),ie=a(7397),me=a(3700),oe=a(5639),ue=a(6718),de=a(7802),Ee=a(67),pe=a(8270),Ze=a(9659);function ge(){return n.createElement(u.Z,{textAlign:"center",p:2},n.createElement("div",null,n.createElement(Ze.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://github.com/degorov/smart-lamp"},"Репозиторий проекта на GitHub")),n.createElement("div",null,"Application icon made by ",n.createElement(Ze.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.freepik.com"},"Freepik")," from ",n.createElement(Ze.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.flaticon.com/"},"www.flaticon.com")))}const ve=(0,r.Z)((e=>({root:{backgroundColor:e.palette.background.paper},icon:{marginTop:"-20px"}})));function he({ip:e,setIp:t,setSave:a}){const l=ve(),[r,c]=(0,n.useContext)(Z),s=(0,n.useContext)(g),[i,m]=(0,n.useState)({ssid:"Smart-Lamp",password:"",showPassword:!1,timezone:3,brightness:184}),o=e=>t=>{m({...i,[e]:t.target.value}),a(d)},u=(0,n.useCallback)((async()=>{r&&(await s.ping()||c(!1))}),[s,r,c]),d=()=>async()=>{await s.ping()||c(!1),a(null)};return(0,n.useEffect)((()=>(window.addEventListener("focus",u),u(),()=>{window.removeEventListener("focus",u),a(null)})),[u,a]),n.createElement(n.Fragment,null,n.createElement(Q.Z,{className:l.root},n.createElement(te.Z,null,"Подключение:"),n.createElement(U.Z,null,n.createElement(ne.Z,{id:"lamp-ip",label:"IP-адрес лампы",variant:"outlined",size:"small",value:e.address,onChange:e=>{const a=e.target.value;/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/.test(a)?t({address:a,valid:!0}):t({address:a,valid:!1})},error:!e.valid}),n.createElement(Y.Z,null,n.createElement(ce.Z,{variant:"contained",color:"primary",disabled:!e.valid,onClick:()=>c()},n.createElement(de.Z,null)))),r?n.createElement(n.Fragment,null,n.createElement(U.Z,null,n.createElement(ne.Z,{id:"ssid",label:"Имя сети",variant:"outlined",size:"small",fullWidth:!0,value:i.ssid,onChange:o("ssid")})),n.createElement(U.Z,null,n.createElement(se.Z,{variant:"outlined",size:"small",fullWidth:!0},n.createElement(me.Z,{htmlFor:"password"},"Пароль сети"),n.createElement(ue.Z,{id:"password",labelWidth:95,type:i.showPassword?"text":"password",value:i.password,onChange:o("password"),endAdornment:n.createElement(ie.Z,{position:"end"},n.createElement(f.Z,{onClick:()=>{m({...i,showPassword:!i.showPassword})},onMouseDown:e=>{e.preventDefault()},edge:"end"},i.showPassword?n.createElement(Ee.Z,null):n.createElement(pe.Z,null)))}))),n.createElement(te.Z,null,"Часовой пояс:"),n.createElement(U.Z,null,n.createElement(ne.Z,{id:"timezone",select:!0,variant:"outlined",size:"small",fullWidth:!0,value:i.timezone,onChange:o("timezone")},n.createElement(oe.Z,{value:2},"МСК−1 (калининградское время)"),n.createElement(oe.Z,{value:3},"МСК (московское время)"),n.createElement(oe.Z,{value:4},"МСК+1 (самарское время)"),n.createElement(oe.Z,{value:5},"МСК+2 (екатеринбургское время)"),n.createElement(oe.Z,{value:6},"МСК+3 (омское время)"),n.createElement(oe.Z,{value:7},"МСК+4 (красноярское время)"),n.createElement(oe.Z,{value:8},"МСК+5 (иркутское время)"),n.createElement(oe.Z,{value:9},"МСК+6 (якутское время)"),n.createElement(oe.Z,{value:10},"МСК+7 (владивостокское время)"),n.createElement(oe.Z,{value:11},"МСК+8 (магаданское время)"),n.createElement(oe.Z,{value:12},"МСК+9 (камчатское время)"))),n.createElement(te.Z,null,"Максимальная яркость:",n.createElement(w.Z,{component:"span",color:i.brightness>184?"error":"initial"}," ",i.brightness)),n.createElement(U.Z,null,n.createElement(_.Z,{container:!0,spacing:2,alignItems:"center"},n.createElement(_.Z,{item:!0,className:l.icon},n.createElement(G.Z,null)),n.createElement(_.Z,{item:!0,xs:!0},n.createElement(j.Z,{min:72,max:255,marks:[{value:184,label:"Предел БП"}],value:i.brightness,onChange:(e,t)=>{m({...i,brightness:t}),a(d)}})),n.createElement(_.Z,{item:!0,className:l.icon},n.createElement(B.Z,null))))):null),n.createElement(ge,null))}const fe=(0,r.Z)((e=>({backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},offset:{paddingBottom:e.mixins.toolbar.minHeight}}))),be=function(){const e=fe(),t=(0,c.Z)("(prefers-color-scheme: dark)"),a=(0,n.useMemo)((()=>(0,s.Z)({palette:{primary:{main:t?"#FFCD14":"#F55528"},secondary:{main:t?"#0AAAD7":"#008CC3"},type:t?"dark":"light"}},m.nx)),[t]),l=["Эффекты","Будильник","Настройки"],[r,h]=(0,n.useState)(!1),[f,b]=(0,n.useState)(null),[w,C]=(0,n.useState)({address:"",valid:!1}),[x,y]=(0,n.useState)(),[k,S]=(0,n.useState)(null),P=(0,n.useMemo)((()=>function(e,t){const a=async(t=(()=>localStorage.getItem("lamp-ip"))(),a)=>{const n=new AbortController,l=setTimeout((()=>n.abort()),5e3);e(!0);try{const r=await fetch("http://".concat(t,"/"),{signal:n.signal,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await r.json()}finally{clearTimeout(l),e(!1)}};return Object.fromEntries(Object.entries(v).map((([e,t])=>[e,t.bind(null,a)])))}(h)),[]);return(0,n.useEffect)((()=>{if(void 0===x&&!w.address&&null===f){const e=localStorage.getItem("lamp-ip");e?C({address:e,valid:!0}):y(!1)}void 0===x&&w.address&&(async()=>{await P.ping(w.address)?(localStorage.setItem("lamp-ip",w.address),y(!0)):y(!1)})(),!0===x&&null===f&&b(0),!1===x&&2!==f&&b(2)}),[P,x,w.address,f]),n.createElement(i.Z,{theme:a},n.createElement(p.ZP,null),n.createElement(E.Z,{disableGutters:!0,maxWidth:"sm"},n.createElement(Z.Provider,{value:[x,y]},n.createElement(N,{title:l[f],save:k}),n.createElement(u.Z,{className:e.offset},n.createElement(g.Provider,{value:P},0===f?n.createElement(q,null):1===f?n.createElement(re,{setSave:S}):2===f?n.createElement(he,{ip:w,setIp:C,setSave:S}):null)),n.createElement(A,{labels:l,page:f,setPage:b}))),n.createElement(o.Z,{className:e.backdrop,open:r},n.createElement(d.Z,{color:"inherit"})))};l.render(n.createElement(be),document.getElementById("app"))}},0,[[3658,666,216],[376,666,216]]]);