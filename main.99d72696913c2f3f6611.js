(self.webpackChunksmart_lamp=self.webpackChunksmart_lamp||[]).push([[179],{180:(e,t,l)=>{"use strict";var a=l(7294),n=l(9060),r=l(1120),c=l(3457),s=l(8129),m=l(1579),o=l(6159),i=l(9702),u=l(7748),d=l(5477),E=l(3832),p=l(5834);const Z=(0,a.createContext)();Z.displayName="ConnectedContext";var g=l(5258),h=l(7812),v=l(8358),f=l(2318),w=l(3375),b=l(739),k=l(5403);const C=(0,r.Z)((e=>({title:{flexGrow:1},save:{marginRight:e.spacing(2)}})));function y({title:e,save:t}){const l=C(),n=(0,a.useContext)(Z);return a.createElement(g.Z,{position:"sticky"},a.createElement(v.Z,null,a.createElement(f.Z,{variant:"h6",className:l.title},e),t?a.createElement(h.Z,{className:l.save,color:"inherit",onClick:t},a.createElement(w.Z,null)):null,n?a.createElement(k.Z,null):a.createElement(b.Z,null)))}var x=l(5881),S=l(8665),N=l(1076),z=l(2832),P=l(9956);const I=(0,r.Z)((e=>({root:{width:"100%",maxWidth:e.breakpoints.values.sm,position:"fixed",bottom:0,zIndex:100}})));function A({page:e,labels:t,setPage:l}){const n=I();return(0,a.useContext)(Z)?a.createElement(x.Z,{className:n.root,showLabels:!0,value:e,onChange:(e,t)=>{l(t)}},a.createElement(S.Z,{label:t[0],icon:a.createElement(P.Z,null)}),a.createElement(S.Z,{label:t[1],icon:a.createElement(N.Z,null)}),a.createElement(S.Z,{label:t[2],icon:a.createElement(z.Z,null)})):null}function F(){const e=(0,a.useContext)(Z);return a.createElement("p",null,"Эффекты ",String(e))}var T=l(3258),L=l(2822),_=l(998),D=l(6869),W=l(1860),G=l(5757),O=l(6837),M=l(9570),R=l(6183);const $=(0,r.Z)((e=>({alarmField:{background:e.palette.background.paper,width:150},timeField:{background:e.palette.background.paper,width:75}})));function j({setSave:e}){const t=$(),l=(0,a.useContext)(Z),[n,r]=(0,a.useState)({enabled:!1,time:"",repeat:0,before:0,after:0});return(0,a.useEffect)((()=>(l&&console.log("LOAD ALARM"),()=>{e(null)})),[l,e]),a.createElement(L.Z,null,a.createElement(_.Z,null,a.createElement(D.Z,null,a.createElement(N.Z,null)),a.createElement(G.Z,{primary:"Будильник включен"}),a.createElement(W.Z,null,a.createElement(M.Z,{color:"primary",edge:"end",checked:!0,onChange:()=>{}}))),a.createElement(_.Z,null,a.createElement(G.Z,{inset:!0,primary:"Время:"}),a.createElement(R.Z,{id:"alarm-time",type:"time",variant:"outlined",size:"small",className:t.alarmField,inputProps:{step:300},value:"",onChange:e=>{}})),a.createElement(O.Z,null,"Повторять по:"),["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"].map(((e,t)=>a.createElement(_.Z,{dense:!0,button:!0,key:t,onClick:()=>{}},a.createElement(D.Z,null,a.createElement(T.Z,{color:"primary",edge:"start",checked:!0,disableRipple:!0})),a.createElement(G.Z,{primary:e})))),a.createElement(O.Z,null,"Настройки рассвета (в минутах):"),a.createElement(_.Z,null,a.createElement(G.Z,{primary:"Рассвет до будильника:"}),a.createElement(W.Z,null,a.createElement(R.Z,{id:"time-before",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))),a.createElement(_.Z,null,a.createElement(G.Z,{primary:"Гореть после будильника:"}),a.createElement(W.Z,null,a.createElement(R.Z,{id:"time-after",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))))}var B=l(282),H=l(4436),J=l(1749),K=l(7397),V=l(3700),q=l(5639),Q=l(6718),U=l(4845),X=l(7816),Y=l(5352),ee=l(7802),te=l(67),le=l(8270),ae=l(9659);function ne(){return a.createElement(u.Z,{textAlign:"center",p:2},a.createElement("div",null,a.createElement(ae.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://github.com/degorov/smart-lamp"},"Репозиторий проекта на GitHub")),a.createElement("div",null,"Application icon made by ",a.createElement(ae.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.freepik.com"},"Freepik")," from ",a.createElement(ae.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.flaticon.com/"},"www.flaticon.com")))}const re=(0,r.Z)((e=>({root:{backgroundColor:e.palette.background.paper},icon:{marginTop:"-20px"}})));function ce({ip:e,setIp:t,connect:l,setSave:n}){const r=re(),c=(0,a.useContext)(Z),[s,m]=(0,a.useState)({ssid:"Smart-Lamp",password:"",showPassword:!1,timezone:3,brightness:192}),o=e=>t=>{m({...s,[e]:t.target.value}),n(i)},i=()=>async()=>{await console.log("SAVE SETTINGS"),n(null)};return(0,a.useEffect)((()=>(c&&console.log("LOAD SETTINGS"),()=>{n(null)})),[c,n]),a.createElement(a.Fragment,null,a.createElement(L.Z,{className:r.root},a.createElement(O.Z,null,"Подключение:"),a.createElement(_.Z,null,a.createElement(R.Z,{id:"lamp-ip",label:"IP-адрес лампы",variant:"outlined",size:"small",value:e.address,onChange:e=>{const l=e.target.value;/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/.test(l)?t({address:l,valid:!0}):t({address:l,valid:!1})},error:!e.valid}),a.createElement(W.Z,null,a.createElement(B.Z,{variant:"contained",color:"primary",disabled:!e.valid,onClick:l},a.createElement(ee.Z,null)))),c?a.createElement(a.Fragment,null,a.createElement(_.Z,null,a.createElement(R.Z,{id:"ssid",label:"Имя сети",variant:"outlined",size:"small",fullWidth:!0,value:s.ssid,onChange:o("ssid")})),a.createElement(_.Z,null,a.createElement(H.Z,{variant:"outlined",size:"small",fullWidth:!0},a.createElement(V.Z,{htmlFor:"password"},"Пароль сети"),a.createElement(Q.Z,{id:"password",labelWidth:95,type:s.showPassword?"text":"password",value:s.password,onChange:o("password"),endAdornment:a.createElement(K.Z,{position:"end"},a.createElement(h.Z,{onClick:()=>{m({...s,showPassword:!s.showPassword})},onMouseDown:e=>{e.preventDefault()},edge:"end"},s.showPassword?a.createElement(te.Z,null):a.createElement(le.Z,null)))}))),a.createElement(O.Z,null,"Часовой пояс:"),a.createElement(_.Z,null,a.createElement(R.Z,{id:"timezone",select:!0,variant:"outlined",size:"small",fullWidth:!0,value:s.timezone,onChange:o("timezone")},a.createElement(q.Z,{value:2},"МСК−1 (калининградское время)"),a.createElement(q.Z,{value:3},"МСК (московское время)"),a.createElement(q.Z,{value:4},"МСК+1 (самарское время)"),a.createElement(q.Z,{value:5},"МСК+2 (екатеринбургское время)"),a.createElement(q.Z,{value:6},"МСК+3 (омское время)"),a.createElement(q.Z,{value:7},"МСК+4 (красноярское время)"),a.createElement(q.Z,{value:8},"МСК+5 (иркутское время)"),a.createElement(q.Z,{value:9},"МСК+6 (якутское время)"),a.createElement(q.Z,{value:10},"МСК+7 (владивостокское время)"),a.createElement(q.Z,{value:11},"МСК+8 (магаданское время)"),a.createElement(q.Z,{value:12},"МСК+9 (камчатское время)"))),a.createElement(O.Z,null,"Максимальная яркость:",a.createElement(f.Z,{component:"span",color:s.brightness>192?"error":"initial"}," ",s.brightness)),a.createElement(_.Z,null,a.createElement(J.Z,{container:!0,spacing:2,alignItems:"center"},a.createElement(J.Z,{item:!0,className:r.icon},a.createElement(Y.Z,null)),a.createElement(J.Z,{item:!0,xs:!0},a.createElement(U.Z,{min:0,max:255,marks:[{value:192,label:"Предел БП"}],value:s.brightness,onChange:(e,t)=>{m({...s,brightness:t}),n(i)}})),a.createElement(J.Z,{item:!0,className:r.icon},a.createElement(X.Z,null))))):null),a.createElement(ne,null))}const se=(0,r.Z)((e=>({backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},offset:{paddingBottom:e.mixins.toolbar.minHeight}}))),me=function(){const e=se(),t=(0,c.Z)("(prefers-color-scheme: dark)"),l=(0,a.useMemo)((()=>(0,s.Z)({palette:{primary:{main:t?"#FFCD14":"#F55528"},secondary:{main:t?"#0AAAD7":"#008CC3"},type:t?"dark":"light"}},o.nx)),[t]),n=["Эффекты","Будильник","Настройки"],[r,g]=(0,a.useState)(!1),[h,v]=(0,a.useState)(null),[f,w]=(0,a.useState)({address:"",valid:!1}),[b,k]=(0,a.useState)(),[C,x]=(0,a.useState)(null);return(0,a.useEffect)((()=>{window.webpackChunksmart_lamp.fetch=async(e,t=localStorage.getItem("lamp-ip"))=>{const l=new AbortController,a=setTimeout((()=>l.abort()),3e3);g(!0);try{const n=await fetch("http://".concat(t,"/"),{signal:l.signal,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await n.json()}finally{clearTimeout(a),g(!1)}}}),[]),(0,a.useEffect)((()=>{if(void 0===b&&!f.address&&null===h){const e=localStorage.getItem("lamp-ip");e?w({address:e,valid:!0}):k(!1)}void 0===b&&f.address&&(async()=>{await async function(e){try{return"OK"===(await window.webpackChunksmart_lamp.fetch({action:"ping"},e)).error}catch(e){return!1}}(f.address)?(localStorage.setItem("lamp-ip",f.address),k(!0)):k(!1)})(),!0===b&&null===h&&v(0),!1===b&&2!==h&&v(2)}),[b,f.address,h]),a.createElement(m.Z,{theme:l},a.createElement(p.ZP,null),a.createElement(E.Z,{disableGutters:!0,maxWidth:"sm"},a.createElement(Z.Provider,{value:b},a.createElement(y,{title:n[h],save:C}),a.createElement(u.Z,{className:e.offset},0===h?a.createElement(F,null):1===h?a.createElement(j,{setSave:x}):2===h?a.createElement(ce,{ip:f,setIp:w,connect:()=>k(),setSave:x}):null),a.createElement(A,{page:h,labels:n,setPage:v}))),a.createElement(i.Z,{className:e.backdrop,open:r},a.createElement(d.Z,{color:"inherit"})))};n.render(a.createElement(me),document.getElementById("app"))}},0,[[3658,666,216],[180,666,216]]]);