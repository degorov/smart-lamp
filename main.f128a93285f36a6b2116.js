(self.webpackChunksmart_lamp=self.webpackChunksmart_lamp||[]).push([[179],{4397:(e,t,l)=>{"use strict";var n=l(7294),a=l(9060),r=l(1120),s=l(3457),c=l(8129),o=l(1579),m=l(6159),i=l(9702),u=l(7748),d=l(5477),E=l(3832),p=l(5834);const Z=(0,n.createContext)();Z.displayName="ConnectionContext";const g=(0,n.createContext)();g.displayName="ApiContext";const v={ping:async function(e,t){try{return"OK"===(await e(t,{action:"ping"})).error}catch(e){return!1}}};var h=l(5258),f=l(7812),b=l(8358),w=l(2318),C=l(3375),y=l(739),k=l(5403);const x=(0,r.Z)((e=>({title:{flexGrow:1},save:{marginRight:e.spacing(2)}})));function S({title:e,save:t}){const l=x(),[a]=(0,n.useContext)(Z);return n.createElement(h.Z,{position:"sticky"},n.createElement(b.Z,null,n.createElement(w.Z,{variant:"h6",className:l.title},e),t?n.createElement(f.Z,{className:l.save,color:"inherit",onClick:t},n.createElement(C.Z,null)):null,a?n.createElement(k.Z,null):n.createElement(y.Z,null)))}var N=l(5881),P=l(8665),z=l(1076),A=l(2832),F=l(9956);const I=(0,r.Z)((e=>({root:{width:"100%",maxWidth:e.breakpoints.values.sm,position:"fixed",bottom:0,zIndex:100}})));function T({page:e,labels:t,setPage:l}){const a=I(),[r]=(0,n.useContext)(Z);return r?n.createElement(N.Z,{className:a.root,showLabels:!0,value:e,onChange:(e,t)=>{l(t)}},n.createElement(P.Z,{label:t[0],icon:n.createElement(F.Z,null)}),n.createElement(P.Z,{label:t[1],icon:n.createElement(z.Z,null)}),n.createElement(P.Z,{label:t[2],icon:n.createElement(A.Z,null)})):null}function L(){const[e]=(0,n.useContext)(Z);return n.createElement("p",null,"Эффекты ",String(e))}var O=l(3258),D=l(2822),W=l(998),G=l(6869),_=l(1860),j=l(5757),M=l(6837),R=l(9570),$=l(6183);const B=(0,r.Z)((e=>({alarmField:{background:e.palette.background.paper,width:150},timeField:{background:e.palette.background.paper,width:75}})));function H({setSave:e}){const t=B(),[l]=(0,n.useContext)(Z),[a,r]=((0,n.useContext)(g),(0,n.useState)({enabled:!1,time:"",repeat:0,before:0,after:0}));return(0,n.useEffect)((()=>(l&&console.log("LOAD ALARM"),()=>{e(null)})),[l,e]),n.createElement(D.Z,null,n.createElement(W.Z,null,n.createElement(G.Z,null,n.createElement(z.Z,null)),n.createElement(j.Z,{primary:"Будильник включен"}),n.createElement(_.Z,null,n.createElement(R.Z,{color:"primary",edge:"end",checked:!0,onChange:()=>{}}))),n.createElement(W.Z,null,n.createElement(j.Z,{inset:!0,primary:"Время:"}),n.createElement($.Z,{id:"alarm-time",type:"time",variant:"outlined",size:"small",className:t.alarmField,inputProps:{step:300},value:"",onChange:e=>{}})),n.createElement(M.Z,null,"Повторять по:"),["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"].map(((e,t)=>n.createElement(W.Z,{dense:!0,button:!0,key:t,onClick:()=>{}},n.createElement(G.Z,null,n.createElement(O.Z,{color:"primary",edge:"start",checked:!0,disableRipple:!0})),n.createElement(j.Z,{primary:e})))),n.createElement(M.Z,null,"Настройки рассвета (в минутах):"),n.createElement(W.Z,null,n.createElement(j.Z,{primary:"Рассвет до будильника:"}),n.createElement(_.Z,null,n.createElement($.Z,{id:"time-before",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))),n.createElement(W.Z,null,n.createElement(j.Z,{primary:"Гореть после будильника:"}),n.createElement(_.Z,null,n.createElement($.Z,{id:"time-after",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))))}var J=l(282),K=l(4436),V=l(1749),q=l(7397),Q=l(3700),U=l(5639),X=l(6718),Y=l(4845),ee=l(7816),te=l(5352),le=l(7802),ne=l(67),ae=l(8270),re=l(9659);function se(){return n.createElement(u.Z,{textAlign:"center",p:2},n.createElement("div",null,n.createElement(re.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://github.com/degorov/smart-lamp"},"Репозиторий проекта на GitHub")),n.createElement("div",null,"Application icon made by ",n.createElement(re.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.freepik.com"},"Freepik")," from ",n.createElement(re.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.flaticon.com/"},"www.flaticon.com")))}const ce=(0,r.Z)((e=>({root:{backgroundColor:e.palette.background.paper},icon:{marginTop:"-20px"}})));function oe({ip:e,setIp:t,setSave:l}){const a=ce(),[r,s]=(0,n.useContext)(Z),[c,o]=((0,n.useContext)(g),(0,n.useState)({ssid:"Smart-Lamp",password:"",showPassword:!1,timezone:3,brightness:192})),m=e=>t=>{o({...c,[e]:t.target.value}),l(i)},i=()=>async()=>{await console.log("SAVE SETTINGS"),l(null)};return(0,n.useEffect)((()=>(r&&console.log("LOAD SETTINGS"),()=>{l(null)})),[r,l]),n.createElement(n.Fragment,null,n.createElement(D.Z,{className:a.root},n.createElement(M.Z,null,"Подключение:"),n.createElement(W.Z,null,n.createElement($.Z,{id:"lamp-ip",label:"IP-адрес лампы",variant:"outlined",size:"small",value:e.address,onChange:e=>{const l=e.target.value;/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/.test(l)?t({address:l,valid:!0}):t({address:l,valid:!1})},error:!e.valid}),n.createElement(_.Z,null,n.createElement(J.Z,{variant:"contained",color:"primary",disabled:!e.valid,onClick:()=>s()},n.createElement(le.Z,null)))),r?n.createElement(n.Fragment,null,n.createElement(W.Z,null,n.createElement($.Z,{id:"ssid",label:"Имя сети",variant:"outlined",size:"small",fullWidth:!0,value:c.ssid,onChange:m("ssid")})),n.createElement(W.Z,null,n.createElement(K.Z,{variant:"outlined",size:"small",fullWidth:!0},n.createElement(Q.Z,{htmlFor:"password"},"Пароль сети"),n.createElement(X.Z,{id:"password",labelWidth:95,type:c.showPassword?"text":"password",value:c.password,onChange:m("password"),endAdornment:n.createElement(q.Z,{position:"end"},n.createElement(f.Z,{onClick:()=>{o({...c,showPassword:!c.showPassword})},onMouseDown:e=>{e.preventDefault()},edge:"end"},c.showPassword?n.createElement(ne.Z,null):n.createElement(ae.Z,null)))}))),n.createElement(M.Z,null,"Часовой пояс:"),n.createElement(W.Z,null,n.createElement($.Z,{id:"timezone",select:!0,variant:"outlined",size:"small",fullWidth:!0,value:c.timezone,onChange:m("timezone")},n.createElement(U.Z,{value:2},"МСК−1 (калининградское время)"),n.createElement(U.Z,{value:3},"МСК (московское время)"),n.createElement(U.Z,{value:4},"МСК+1 (самарское время)"),n.createElement(U.Z,{value:5},"МСК+2 (екатеринбургское время)"),n.createElement(U.Z,{value:6},"МСК+3 (омское время)"),n.createElement(U.Z,{value:7},"МСК+4 (красноярское время)"),n.createElement(U.Z,{value:8},"МСК+5 (иркутское время)"),n.createElement(U.Z,{value:9},"МСК+6 (якутское время)"),n.createElement(U.Z,{value:10},"МСК+7 (владивостокское время)"),n.createElement(U.Z,{value:11},"МСК+8 (магаданское время)"),n.createElement(U.Z,{value:12},"МСК+9 (камчатское время)"))),n.createElement(M.Z,null,"Максимальная яркость:",n.createElement(w.Z,{component:"span",color:c.brightness>192?"error":"initial"}," ",c.brightness)),n.createElement(W.Z,null,n.createElement(V.Z,{container:!0,spacing:2,alignItems:"center"},n.createElement(V.Z,{item:!0,className:a.icon},n.createElement(te.Z,null)),n.createElement(V.Z,{item:!0,xs:!0},n.createElement(Y.Z,{min:0,max:255,marks:[{value:192,label:"Предел БП"}],value:c.brightness,onChange:(e,t)=>{o({...c,brightness:t}),l(i)}})),n.createElement(V.Z,{item:!0,className:a.icon},n.createElement(ee.Z,null))))):null),n.createElement(se,null))}const me=(0,r.Z)((e=>({backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},offset:{paddingBottom:e.mixins.toolbar.minHeight}}))),ie=function(){const e=me(),t=(0,s.Z)("(prefers-color-scheme: dark)"),l=(0,n.useMemo)((()=>(0,c.Z)({palette:{primary:{main:t?"#FFCD14":"#F55528"},secondary:{main:t?"#0AAAD7":"#008CC3"},type:t?"dark":"light"}},m.nx)),[t]),a=["Эффекты","Будильник","Настройки"],[r,h]=(0,n.useState)(!1),[f,b]=(0,n.useState)(null),[w,C]=(0,n.useState)({address:"",valid:!1}),[y,k]=(0,n.useState)(),[x,N]=(0,n.useState)(null),P=(0,n.useMemo)((()=>function(e){const t=async(t,l)=>{const n=new AbortController,a=setTimeout((()=>n.abort()),3e3);e(!0);try{const r=await fetch("http://".concat(t,"/"),{signal:n.signal,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});return await r.json()}finally{clearTimeout(a),e(!1)}};return Object.fromEntries(Object.entries(v).map((([e,l])=>[e,l.bind(null,t)])))}(h)),[]);return(0,n.useEffect)((()=>{if(void 0===y&&!w.address&&null===f){const e=localStorage.getItem("lamp-ip");e?C({address:e,valid:!0}):k(!1)}void 0===y&&w.address&&(async()=>{await P.ping(w.address)?(localStorage.setItem("lamp-ip",w.address),k(!0)):k(!1)})(),!0===y&&null===f&&b(0),!1===y&&2!==f&&b(2)}),[P,y,w.address,f]),n.createElement(o.Z,{theme:l},n.createElement(p.ZP,null),n.createElement(E.Z,{disableGutters:!0,maxWidth:"sm"},n.createElement(Z.Provider,{value:[y,k]},n.createElement(S,{title:a[f],save:x}),n.createElement(u.Z,{className:e.offset},n.createElement(g.Provider,{value:P},0===f?n.createElement(L,null):1===f?n.createElement(H,{setSave:N}):2===f?n.createElement(oe,{ip:w,setIp:C,setSave:N}):null)),n.createElement(T,{labels:a,page:f,setPage:b}))),n.createElement(i.Z,{className:e.backdrop,open:r},n.createElement(d.Z,{color:"inherit"})))};a.render(n.createElement(ie),document.getElementById("app"))}},0,[[3658,666,216],[4397,666,216]]]);