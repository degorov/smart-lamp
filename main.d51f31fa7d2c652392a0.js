(self.webpackChunksmart_lamp=self.webpackChunksmart_lamp||[]).push([[179],{4397:(e,t,a)=>{"use strict";var n=a(7294),l=a(9060),r=a(1120),c=a(3457),m=a(8129),s=a(1579),o=a(6159),i=a(9702),u=a(7748),d=a(5477),E=a(3832),p=a(5834);const Z=(0,n.createContext)();Z.displayName="ConnectionContext";const g=(0,n.createContext)();g.displayName="ApiContext";const v={ping:async function(e,t){try{return"OK"===(await e(t,{action:"ping"})).error}catch(e){return!1}}};var h=a(5258),f=a(7812),w=a(8358),b=a(2318),C=a(3375),x=a(739),y=a(5403);const k=(0,r.Z)((e=>({title:{flexGrow:1},save:{marginRight:e.spacing(2)}})));function S({title:e,save:t}){const a=k(),[l]=(0,n.useContext)(Z);return n.createElement(h.Z,{position:"sticky"},n.createElement(w.Z,null,n.createElement(b.Z,{variant:"h6",className:a.title},e||"Светильник"),t?n.createElement(f.Z,{className:a.save,color:"inherit",onClick:t},n.createElement(C.Z,null)):null,l?n.createElement(y.Z,null):n.createElement(x.Z,null)))}var I=a(5881),N=a(8665),P=a(1076),z=a(2832),F=a(9956);const L=(0,r.Z)((e=>({root:{width:"100%",maxWidth:e.breakpoints.values.sm,position:"fixed",bottom:0,zIndex:100}})));function A({page:e,labels:t,setPage:a}){const l=L(),[r]=(0,n.useContext)(Z);return n.createElement(I.Z,{className:l.root,showLabels:!0,value:e,onChange:(e,t)=>{a(t)}},n.createElement(N.Z,{label:t[0],icon:n.createElement(F.Z,null),disabled:!r}),n.createElement(N.Z,{label:t[1],icon:n.createElement(P.Z,null),disabled:!r}),n.createElement(N.Z,{label:t[2],icon:n.createElement(z.Z,null)}))}var D=a(1056),M=a(1201),T=a(743),W=a(3258),O=a(553),_=a(1749),j=a(4845),G=a(6447),R=a(7816),$=a(5352),B=a(4566);const H=(0,r.Z)((e=>({slider:{padding:e.spacing(2)},params:{marginLeft:e.spacing(1),marginRight:e.spacing(1)}})));function J(e,t){return 256*e+t%256}function K(e,t){return 256*Math.floor(t/256)+e}function V({children:e,open:t,value:a}){return n.createElement(G.ZP,{open:t,enterTouchDelay:0,placement:"top",title:a},e)}function q(){const e=H(),[,t]=(0,n.useContext)(Z),a=(0,n.useContext)(g),[l,r]=(0,n.useState)(16),[c,m]=(0,n.useState)(16),[s,o]=(0,n.useState)({index:3,value:20,save:!1}),i=[0,255,192,20,20,-40,4,5,10,1],u=e=>(t,a)=>{o(a?{index:e,value:i[e],save:!0}:{index:0,value:0,save:!0})},d=e=>{o({...s,value:e,save:!1})},E=e=>{o({...s,value:e,save:!0})},p=(0,n.useCallback)((async()=>{await a.ping(localStorage.getItem("lamp-ip"))||t(!1),r(128),m(184)}),[a,t]);return(0,n.useEffect)((()=>{s.save&&(async()=>{console.log("save effect: ".concat(s.index,", value: ").concat(Math.abs(s.value))),await a.ping(localStorage.getItem("lamp-ip"))||t(!1)})()}),[a,t,s]),(0,n.useEffect)((()=>(window.addEventListener("focus",p),p(),()=>{window.removeEventListener("focus",p)})),[p]),n.createElement(n.Fragment,null,n.createElement(_.Z,{container:!0,spacing:2,alignItems:"center",className:e.slider},n.createElement(_.Z,{item:!0},n.createElement($.Z,null)),n.createElement(_.Z,{item:!0,xs:!0},n.createElement(j.Z,{min:16,max:c,valueLabelDisplay:"auto",ValueLabelComponent:V,value:l,onChange:(e,t)=>{r(t)},onChangeCommitted:async(e,n)=>{console.log("save brightness: ".concat(n)),await a.ping(localStorage.getItem("lamp-ip"))||t(!1)}})),n.createElement(_.Z,{item:!0},n.createElement(R.Z,null))),n.createElement(D.Z,{expanded:1===s.index,onChange:u(1)},n.createElement(T.Z,{expandIcon:n.createElement(B.Z,null)},n.createElement(b.Z,null,"Выбранный цвет")),n.createElement(M.Z,{className:e.params},n.createElement(_.Z,{container:!0,spacing:3},n.createElement(_.Z,{item:!0,xs:12},n.createElement(j.Z,{track:!1,min:0,max:255,value:Math.floor(s.value/256),onChange:(e,t)=>d(J(t,s.value)),onChangeCommitted:(e,t)=>E(J(t,s.value))})),n.createElement(_.Z,{item:!0,xs:12},n.createElement(j.Z,{track:!1,min:0,max:255,value:s.value%256,onChange:(e,t)=>d(K(t,s.value)),onChangeCommitted:(e,t)=>E(K(t,s.value))}))))),[[2,"Цвета по кругу",0,255],[3,"Вертикальная радуга",0,32],[4,"Горизонтальная радуга",0,32],[5,"Матрица",-150,-5],[6,"Вспышки",1,32],[7,"Светлячки",1,16],[8,"Плазма",5,50]].map((t=>n.createElement(D.Z,{key:t[0],expanded:s.index===t[0],onChange:u(t[0])},n.createElement(T.Z,{expandIcon:n.createElement(B.Z,null)},n.createElement(b.Z,null,t[1])),n.createElement(M.Z,{className:e.params},n.createElement(j.Z,{track:!1,min:t[2],max:t[3],value:s.value,onChange:(e,t)=>d(t),onChangeCommitted:(e,t)=>E(t)}))))),n.createElement(D.Z,{expanded:9===s.index,onChange:u(9)},n.createElement(T.Z,{expandIcon:n.createElement(B.Z,null)},n.createElement(b.Z,null,"Огонь")),n.createElement(M.Z,{className:e.params},n.createElement(O.Z,{control:n.createElement(W.Z,{checked:!!s.value,onChange:e=>{o({...s,value:+e.target.checked,save:!0})},color:"primary"}),label:"Искры"}))))}var Q=a(2822),U=a(998),X=a(6869),Y=a(1860),ee=a(5757),te=a(6837),ae=a(9570),ne=a(1411);const le=(0,r.Z)((e=>({alarmField:{background:e.palette.background.paper,width:150},timeField:{background:e.palette.background.paper,width:75}})));function re({setSave:e}){const t=le(),[,a]=(0,n.useContext)(Z),l=(0,n.useContext)(g),[r,c]=(0,n.useState)({enabled:!1,time:"",repeat:0,before:0,after:0}),m=(0,n.useCallback)((async()=>{await l.ping(localStorage.getItem("lamp-ip"))||a(!1)}),[l,a]);return(0,n.useEffect)((()=>(window.addEventListener("focus",m),m(),()=>{window.removeEventListener("focus",m),e(null)})),[m,e]),n.createElement(Q.Z,null,n.createElement(U.Z,null,n.createElement(X.Z,null,n.createElement(P.Z,null)),n.createElement(ee.Z,{primary:"Будильник включен"}),n.createElement(Y.Z,null,n.createElement(ae.Z,{color:"primary",edge:"end",checked:!0,onChange:()=>{}}))),n.createElement(U.Z,null,n.createElement(ee.Z,{inset:!0,primary:"Время:"}),n.createElement(ne.Z,{id:"alarm-time",type:"time",variant:"outlined",size:"small",className:t.alarmField,inputProps:{step:300},value:"",onChange:e=>{}})),n.createElement(te.Z,null,"Повторять по:"),["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"].map(((e,t)=>n.createElement(U.Z,{dense:!0,button:!0,key:t,onClick:()=>{}},n.createElement(X.Z,null,n.createElement(W.Z,{color:"primary",edge:"start",checked:!0,disableRipple:!0})),n.createElement(ee.Z,{primary:e})))),n.createElement(te.Z,null,"Настройки рассвета (в минутах):"),n.createElement(U.Z,null,n.createElement(ee.Z,{primary:"Рассвет до будильника:"}),n.createElement(Y.Z,null,n.createElement(ne.Z,{id:"time-before",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))),n.createElement(U.Z,null,n.createElement(ee.Z,{primary:"Гореть после будильника:"}),n.createElement(Y.Z,null,n.createElement(ne.Z,{id:"time-after",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))))}var ce=a(282),me=a(4436),se=a(7397),oe=a(3700),ie=a(5639),ue=a(6718),de=a(7802),Ee=a(67),pe=a(8270),Ze=a(9659);function ge(){return n.createElement(u.Z,{textAlign:"center",p:2},n.createElement("div",null,n.createElement(Ze.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://github.com/degorov/smart-lamp"},"Репозиторий проекта на GitHub")),n.createElement("div",null,"Application icon made by ",n.createElement(Ze.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.freepik.com"},"Freepik")," from ",n.createElement(Ze.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.flaticon.com/"},"www.flaticon.com")))}const ve=(0,r.Z)((e=>({root:{backgroundColor:e.palette.background.paper},icon:{marginTop:"-20px"}})));function he({ip:e,setIp:t,setSave:a}){const l=ve(),[r,c]=(0,n.useContext)(Z),m=(0,n.useContext)(g),[s,o]=(0,n.useState)({ssid:"Smart-Lamp",password:"",showPassword:!1,timezone:3,brightness:184}),i=e=>t=>{o({...s,[e]:t.target.value}),a(d)},u=(0,n.useCallback)((async()=>{r&&(await m.ping(localStorage.getItem("lamp-ip"))||c(!1))}),[m,r,c]),d=()=>async()=>{await m.ping(localStorage.getItem("lamp-ip"))||c(!1),a(null)};return(0,n.useEffect)((()=>(window.addEventListener("focus",u),u(),()=>{window.removeEventListener("focus",u),a(null)})),[u,a]),n.createElement(n.Fragment,null,n.createElement(Q.Z,{className:l.root},n.createElement(te.Z,null,"Подключение:"),n.createElement(U.Z,null,n.createElement(ne.Z,{id:"lamp-ip",label:"IP-адрес лампы",variant:"outlined",size:"small",value:e.address,onChange:e=>{const a=e.target.value;/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/.test(a)?t({address:a,valid:!0}):t({address:a,valid:!1})},error:!e.valid}),n.createElement(Y.Z,null,n.createElement(ce.Z,{variant:"contained",color:"primary",disabled:!e.valid,onClick:()=>c()},n.createElement(de.Z,null)))),r?n.createElement(n.Fragment,null,n.createElement(U.Z,null,n.createElement(ne.Z,{id:"ssid",label:"Имя сети",variant:"outlined",size:"small",fullWidth:!0,value:s.ssid,onChange:i("ssid")})),n.createElement(U.Z,null,n.createElement(me.Z,{variant:"outlined",size:"small",fullWidth:!0},n.createElement(oe.Z,{htmlFor:"password"},"Пароль сети"),n.createElement(ue.Z,{id:"password",labelWidth:95,type:s.showPassword?"text":"password",value:s.password,onChange:i("password"),endAdornment:n.createElement(se.Z,{position:"end"},n.createElement(f.Z,{onClick:()=>{o({...s,showPassword:!s.showPassword})},onMouseDown:e=>{e.preventDefault()},edge:"end"},s.showPassword?n.createElement(Ee.Z,null):n.createElement(pe.Z,null)))}))),n.createElement(te.Z,null,"Часовой пояс:"),n.createElement(U.Z,null,n.createElement(ne.Z,{id:"timezone",select:!0,variant:"outlined",size:"small",fullWidth:!0,value:s.timezone,onChange:i("timezone")},n.createElement(ie.Z,{value:2},"МСК−1 (калининградское время)"),n.createElement(ie.Z,{value:3},"МСК (московское время)"),n.createElement(ie.Z,{value:4},"МСК+1 (самарское время)"),n.createElement(ie.Z,{value:5},"МСК+2 (екатеринбургское время)"),n.createElement(ie.Z,{value:6},"МСК+3 (омское время)"),n.createElement(ie.Z,{value:7},"МСК+4 (красноярское время)"),n.createElement(ie.Z,{value:8},"МСК+5 (иркутское время)"),n.createElement(ie.Z,{value:9},"МСК+6 (якутское время)"),n.createElement(ie.Z,{value:10},"МСК+7 (владивостокское время)"),n.createElement(ie.Z,{value:11},"МСК+8 (магаданское время)"),n.createElement(ie.Z,{value:12},"МСК+9 (камчатское время)"))),n.createElement(te.Z,null,"Максимальная яркость:",n.createElement(b.Z,{component:"span",color:s.brightness>184?"error":"initial"}," ",s.brightness)),n.createElement(U.Z,null,n.createElement(_.Z,{container:!0,spacing:2,alignItems:"center"},n.createElement(_.Z,{item:!0,className:l.icon},n.createElement($.Z,null)),n.createElement(_.Z,{item:!0,xs:!0},n.createElement(j.Z,{min:72,max:255,marks:[{value:184,label:"Предел БП"}],value:s.brightness,onChange:(e,t)=>{o({...s,brightness:t}),a(d)}})),n.createElement(_.Z,{item:!0,className:l.icon},n.createElement(R.Z,null))))):null),n.createElement(ge,null))}const fe=(0,r.Z)((e=>({backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},offset:{paddingBottom:e.mixins.toolbar.minHeight}}))),we=function(){const e=fe(),t=(0,c.Z)("(prefers-color-scheme: dark)"),a=(0,n.useMemo)((()=>(0,m.Z)({palette:{primary:{main:t?"#FFCD14":"#F55528"},secondary:{main:t?"#0AAAD7":"#008CC3"},type:t?"dark":"light"}},o.nx)),[t]),l=["Эффекты","Будильник","Настройки"],[r,h]=(0,n.useState)(!1),[f,w]=(0,n.useState)(null),[b,C]=(0,n.useState)({address:"",valid:!1}),[x,y]=(0,n.useState)(),[k,I]=(0,n.useState)(null),N=(0,n.useMemo)((()=>function(e){const t=async(t,a)=>{const n=new AbortController,l=setTimeout((()=>n.abort()),5e3);e(!0);try{const r=await fetch("http://".concat(t,"/"),{signal:n.signal,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await r.json()}finally{clearTimeout(l),e(!1)}};return Object.fromEntries(Object.entries(v).map((([e,a])=>[e,a.bind(null,t)])))}(h)),[]);return(0,n.useEffect)((()=>{if(void 0===x&&!b.address&&null===f){const e=localStorage.getItem("lamp-ip");e?C({address:e,valid:!0}):y(!1)}void 0===x&&b.address&&(async()=>{await N.ping(b.address)?(localStorage.setItem("lamp-ip",b.address),y(!0)):y(!1)})(),!0===x&&null===f&&w(0),!1===x&&2!==f&&w(2)}),[N,x,b.address,f]),n.createElement(s.Z,{theme:a},n.createElement(p.ZP,null),n.createElement(E.Z,{disableGutters:!0,maxWidth:"sm"},n.createElement(Z.Provider,{value:[x,y]},n.createElement(S,{title:l[f],save:k}),n.createElement(u.Z,{className:e.offset},n.createElement(g.Provider,{value:N},0===f?n.createElement(q,null):1===f?n.createElement(re,{setSave:I}):2===f?n.createElement(he,{ip:b,setIp:C,setSave:I}):null)),n.createElement(A,{labels:l,page:f,setPage:w}))),n.createElement(i.Z,{className:e.backdrop,open:r},n.createElement(d.Z,{color:"inherit"})))};l.render(n.createElement(we),document.getElementById("app"))}},0,[[3658,666,216],[4397,666,216]]]);