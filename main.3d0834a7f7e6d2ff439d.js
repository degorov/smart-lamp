(self.webpackChunksmart_lamp=self.webpackChunksmart_lamp||[]).push([[179],{7956:(e,t,a)=>{"use strict";var n=a(7294),l=a(9060),r=a(1120),s=a(3457),c=a(8129),i=a(1579),m=a(6159),o=a(2692),u=a(7748),d=a(5477),p=a(3832),E=a(5834);const Z=(0,n.createContext)();Z.displayName="ConnectionContext";const g=(0,n.createContext)();g.displayName="ApiContext";const v={ping:async function(e,t){try{return"OK"===(await e(t,{action:"ping"})).error}catch(e){return!1}},geteffects:async function(e,t){try{const a=await e(t,{action:"geteffects"});return"OK"===a.error&&{brightness:+a.brightness,maxbrightness:+a.maxbrightness,index:+a.index,value:+a.value}}catch(e){return!1}},setbrightness:async function(e,t,a){try{return"OK"===(await e(a,{action:"setbrightness",value:t})).error}catch(e){return!1}},seteffect:async function(e,t,a,n){try{return"OK"===(await e(n,{action:"seteffect",index:t,value:a})).error}catch(e){return!1}},getsettings:async function(e,t){try{const a=await e(t,{action:"getsettings"});return"OK"===a.error&&{ssid:a.ssid,password:a.password,timezone:+a.timezone,maxbrightness:+a.maxbrightness}}catch(e){return!1}},savesettings:async function(e,t,a,n,l,r){try{return"OK"===(await e(r,{action:"savesettings",ssid:t,password:a,timezone:n,maxbrightness:l})).error}catch(e){return!1}},getalarm:async function(e,t){try{const a=await e(t,{action:"getalarm"});return"OK"===a.error&&{apmode:!!a.apmode,enabled:!!a.enabled,time:a.time,repeat:+a.repeat,before:+a.before,after:+a.after}}catch(e){return!1}},savealarm:async function(e,t,a,n,l,r,s){try{return"OK"===(await e(s,{action:"savealarm",enabled:+t,repeat:a,time:n,before:l,after:r})).error}catch(e){return!1}}};var f=a(5258),h=a(7812),b=a(8358),w=a(2318),y=a(3375),x=a(739),C=a(5403);const k=(0,r.Z)((e=>({title:{flexGrow:1},save:{marginRight:e.spacing(2)}})));function N({title:e,save:t}){const a=k(),[l]=(0,n.useContext)(Z);return n.createElement(f.Z,{position:"sticky"},n.createElement(b.Z,null,n.createElement(w.Z,{variant:"h6",className:a.title},e||"Светильник"),t?n.createElement(h.Z,{className:a.save,color:"inherit",onClick:t},n.createElement(y.Z,null)):null,l?n.createElement(C.Z,null):n.createElement(x.Z,null)))}var z=a(5881),S=a(8665),P=a(1076),I=a(2832),F=a(9956);const L=(0,r.Z)((e=>({root:{width:"100%",maxWidth:e.breakpoints.values.sm,position:"fixed",bottom:0,zIndex:100}})));function O({page:e,labels:t,setPage:a}){const l=L(),[r]=(0,n.useContext)(Z);return n.createElement(z.Z,{className:l.root,showLabels:!0,value:e,onChange:(e,t)=>{a(t)}},n.createElement(S.Z,{label:t[0],icon:n.createElement(F.Z,null),disabled:!r}),n.createElement(S.Z,{label:t[1],icon:n.createElement(P.Z,null),disabled:!r}),n.createElement(S.Z,{label:t[2],icon:n.createElement(I.Z,null)}))}var A=a(1056),K=a(1201),T=a(743),W=a(3258),D=a(553),M=a(1749),_=a(4845),j=a(6447),R=a(7816),B=a(5352),G=a(4566);const $=(0,r.Z)((e=>({slider:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},icon:{paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},params:{marginLeft:e.spacing(1),marginRight:e.spacing(1)}})));function H(e,t){return 256*e+t%256}function J(e,t){return 256*Math.floor(t/256)+e}function V({children:e,open:t,value:a}){return n.createElement(j.ZP,{open:t,enterTouchDelay:0,placement:"top",title:a},e)}function q(){const e=$(),[,t]=(0,n.useContext)(Z),a=(0,n.useContext)(g),[l,r]=(0,n.useState)(16),[s,c]=(0,n.useState)(16),[i,m]=(0,n.useState)({index:0,value:0,save:!1}),o=[0,255,192,20,20,-40,4,5,10,1],u=e=>(t,a)=>{m(a?{index:e,value:o[e],save:!0}:{index:0,value:0,save:!0})},d=e=>{m({...i,value:e,save:!1})},p=e=>{m({...i,value:e,save:!0})},E=(0,n.useCallback)((async()=>{const e=await a.geteffects();e?(m({index:e.index,value:e.value,save:!1}),r(e.brightness),c(e.maxbrightness)):t(!1)}),[a,t]);return(0,n.useEffect)((()=>{i.save&&(async()=>{await a.seteffect(i.index,Math.abs(i.value))||t(!1)})()}),[a,t,i]),(0,n.useEffect)((()=>(window.addEventListener("focus",E),E(),()=>{window.removeEventListener("focus",E)})),[E]),n.createElement(n.Fragment,null,n.createElement(M.Z,{container:!0,alignItems:"center",className:e.slider},n.createElement(M.Z,{item:!0,className:e.icon},n.createElement(B.Z,null)),n.createElement(M.Z,{item:!0,xs:!0},n.createElement(_.Z,{min:16,max:s,valueLabelDisplay:"auto",ValueLabelComponent:V,value:l,onChange:(e,t)=>{r(t)},onChangeCommitted:async(e,n)=>{await a.setbrightness(n)||t(!1)}})),n.createElement(M.Z,{item:!0,className:e.icon},n.createElement(R.Z,null))),n.createElement(A.Z,{expanded:1===i.index,onChange:u(1)},n.createElement(T.Z,{expandIcon:n.createElement(G.Z,null)},n.createElement(w.Z,null,"Выбранный цвет")),n.createElement(K.Z,{className:e.params},n.createElement(M.Z,{container:!0,spacing:3},n.createElement(M.Z,{item:!0,xs:12},n.createElement(_.Z,{track:!1,min:0,max:255,marks:[{value:0,label:"К"},{value:32,label:"О"},{value:64,label:"Ж"},{value:96,label:"З"},{value:128,label:"Г"},{value:160,label:"С"},{value:192,label:"Ф"},{value:224,label:"Р"},{value:255,label:"К"}],value:Math.floor(i.value/256),onChange:(e,t)=>d(H(t,i.value)),onChangeCommitted:(e,t)=>p(H(t,i.value))})),n.createElement(M.Z,{item:!0,xs:12},n.createElement(_.Z,{track:!1,min:0,max:255,value:i.value%256,onChange:(e,t)=>d(J(t,i.value)),onChangeCommitted:(e,t)=>p(J(t,i.value))}))))),[[2,"Цвета по кругу",0,255],[3,"Вертикальная радуга",0,32],[4,"Горизонтальная радуга",0,32],[5,"Матрица",-150,-5],[6,"Вспышки",1,32],[7,"Светлячки",1,16],[8,"Плазма",5,50]].map((t=>n.createElement(A.Z,{key:t[0],expanded:i.index===t[0],onChange:u(t[0])},n.createElement(T.Z,{expandIcon:n.createElement(G.Z,null)},n.createElement(w.Z,null,t[1])),n.createElement(K.Z,{className:e.params},n.createElement(_.Z,{track:!1,min:t[2],max:t[3],value:i.value,onChange:(e,t)=>d(t),onChangeCommitted:(e,t)=>p(t)}))))),n.createElement(A.Z,{expanded:9===i.index,onChange:u(9)},n.createElement(T.Z,{expandIcon:n.createElement(G.Z,null)},n.createElement(w.Z,null,"Огонь")),n.createElement(K.Z,{className:e.params},n.createElement(D.Z,{control:n.createElement(W.Z,{checked:!!i.value,onChange:e=>{m({...i,value:+e.target.checked,save:!0})},color:"primary"}),label:"Искры"}))))}var Q=a(2822),U=a(998),X=a(6869),Y=a(1860),ee=a(5757),te=a(6837),ae=a(9570),ne=a(9776);const le=(0,r.Z)((e=>({alarmField:{background:e.palette.background.paper,width:150},timeField:{background:e.palette.background.paper,width:75},message:{padding:e.spacing(2)}})));function re({setSave:e}){const t=le(),[,a]=(0,n.useContext)(Z),l=(0,n.useContext)(g),[r,s]=(0,n.useState)({apmode:!1,enabled:!1,repeat:0,time:"",before:0,after:0}),c=t=>a=>{s({...r,[t]:a.target.value}),e(o)},i=t=>a=>{a.target.checked?s({...r,repeat:1<<6-t|r.repeat}):s({...r,repeat:~(1<<6-t)&r.repeat}),e(o)},m=(0,n.useCallback)((async()=>{const e=await l.getalarm();e?s({apmode:e.apmode,enabled:e.enabled,repeat:e.repeat,time:e.time,before:e.before,after:e.after}):a(!1)}),[l,a]),o=()=>async()=>{s((e=>((async()=>{await l.savealarm(e.enabled,e.repeat,e.time,e.before,e.after)||a(!1)})(),e))),e(null)};return(0,n.useEffect)((()=>(window.addEventListener("focus",m),m(),()=>{window.removeEventListener("focus",m),e(null)})),[m,e]),r.apmode?n.createElement(w.Z,{align:"center",className:t.message},"Настройка будильника будет доступна после подключения светильника к сети Wi-Fi с доступом в Интернет для синхронизации с серверами точного времени."):n.createElement(Q.Z,null,n.createElement(U.Z,null,n.createElement(X.Z,null,n.createElement(P.Z,null)),n.createElement(ee.Z,{primary:"Будильник включен"}),n.createElement(Y.Z,null,n.createElement(ae.Z,{color:"primary",edge:"end",checked:r.enabled,onChange:t=>{s({...r,enabled:t.target.checked}),e(o)}}))),n.createElement(U.Z,null,n.createElement(ee.Z,{inset:!0,primary:"Время:"}),n.createElement(ne.Z,{id:"alarm-time",type:"time",variant:"outlined",size:"small",className:t.alarmField,inputProps:{step:300},value:r.time,onChange:c("time")})),n.createElement(te.Z,null,"Повторять по:"),["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"].map(((e,t)=>n.createElement(U.Z,{dense:!0,button:!0,key:t,disableRipple:!0},n.createElement(X.Z,null,n.createElement(W.Z,{color:"primary",edge:"start",checked:!!(1<<6-t&r.repeat),onClick:i(t)})),n.createElement(ee.Z,{primary:e})))),n.createElement(te.Z,null,"Настройки рассвета (в минутах):"),n.createElement(U.Z,null,n.createElement(ee.Z,{primary:"Рассвет до будильника:"}),n.createElement(Y.Z,null,n.createElement(ne.Z,{id:"time-before",size:"small",variant:"outlined",className:t.timeField,type:"number",inputProps:{maxLength:2},value:r.before,onChange:c("before")}))),n.createElement(U.Z,null,n.createElement(ee.Z,{primary:"Гореть после будильника:"}),n.createElement(Y.Z,null,n.createElement(ne.Z,{id:"time-after",size:"small",variant:"outlined",className:t.timeField,type:"number",inputProps:{maxLength:2},value:r.after,onChange:c("after")}))))}var se=a(282),ce=a(2663),ie=a(6856),me=a(9525),oe=a(7212),ue=a(6083),de=a(4436),pe=a(7397),Ee=a(3700),Ze=a(5639),ge=a(6718),ve=a(7802),fe=a(67),he=a(8270),be=a(9659);function we(){return n.createElement(u.Z,{textAlign:"center",p:2},n.createElement("div",null,n.createElement(be.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://github.com/degorov/smart-lamp"},"Репозиторий проекта на GitHub")),n.createElement("div",null,"Application icon made by ",n.createElement(be.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.freepik.com"},"Freepik")," from ",n.createElement(be.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.flaticon.com/"},"www.flaticon.com")))}const ye=(0,r.Z)((e=>({root:{backgroundColor:e.palette.background.paper},icon:{marginTop:"-20px"}})));function xe({ip:e,setIp:t,setSave:a}){const l=ye(),[r,s]=(0,n.useContext)(Z),c=(0,n.useContext)(g),[i,m]=n.useState(!1),o=()=>m(!1),[u,d]=(0,n.useState)({ssid:"",password:"",showPassword:!1,timezone:3,brightness:0}),p=e=>t=>{d({...u,[e]:t.target.value}),a(v)},E=(0,n.useCallback)((async()=>{if(r){const e=await c.getsettings();e?d((t=>({...t,ssid:e.ssid,password:e.password,timezone:e.timezone,brightness:e.maxbrightness}))):s(!1)}}),[c,r,s]),v=()=>async()=>{d((e=>((async()=>{await c.savesettings(e.ssid,e.password,e.timezone,e.brightness)&&m(!0),s(!1)})(),e))),a(null)};return(0,n.useEffect)((()=>(window.addEventListener("focus",E),E(),()=>{window.removeEventListener("focus",E),a(null)})),[E,a]),n.createElement(n.Fragment,null,n.createElement(Q.Z,{className:l.root},n.createElement(te.Z,null,"Подключение:"),n.createElement(U.Z,null,n.createElement(ne.Z,{id:"lamp-ip",label:"IP-адрес лампы",variant:"outlined",size:"small",value:e.address,onChange:e=>{const a=e.target.value;/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/.test(a)?t({address:a,valid:!0}):t({address:a,valid:!1})},error:!e.valid}),n.createElement(Y.Z,null,n.createElement(se.Z,{variant:"contained",color:"primary",disabled:!e.valid,onClick:()=>s()},n.createElement(ve.Z,null)))),r?n.createElement(n.Fragment,null,n.createElement(U.Z,null,n.createElement(ne.Z,{id:"ssid",label:"Имя сети",variant:"outlined",size:"small",fullWidth:!0,value:u.ssid,onChange:p("ssid")})),n.createElement(U.Z,null,n.createElement(de.Z,{variant:"outlined",size:"small",fullWidth:!0},n.createElement(Ee.Z,{htmlFor:"password"},"Пароль сети"),n.createElement(ge.Z,{id:"password",labelWidth:95,type:u.showPassword?"text":"password",value:u.password,onChange:p("password"),endAdornment:n.createElement(pe.Z,{position:"end"},n.createElement(h.Z,{onClick:()=>{d({...u,showPassword:!u.showPassword})},onMouseDown:e=>{e.preventDefault()},edge:"end"},u.showPassword?n.createElement(fe.Z,null):n.createElement(he.Z,null)))}))),n.createElement(te.Z,null,"Часовой пояс:"),n.createElement(U.Z,null,n.createElement(ne.Z,{id:"timezone",select:!0,variant:"outlined",size:"small",fullWidth:!0,value:u.timezone,onChange:p("timezone")},n.createElement(Ze.Z,{value:2},"МСК−1 (калининградское время)"),n.createElement(Ze.Z,{value:3},"МСК (московское время)"),n.createElement(Ze.Z,{value:4},"МСК+1 (самарское время)"),n.createElement(Ze.Z,{value:5},"МСК+2 (екатеринбургское время)"),n.createElement(Ze.Z,{value:6},"МСК+3 (омское время)"),n.createElement(Ze.Z,{value:7},"МСК+4 (красноярское время)"),n.createElement(Ze.Z,{value:8},"МСК+5 (иркутское время)"),n.createElement(Ze.Z,{value:9},"МСК+6 (якутское время)"),n.createElement(Ze.Z,{value:10},"МСК+7 (владивостокское время)"),n.createElement(Ze.Z,{value:11},"МСК+8 (магаданское время)"),n.createElement(Ze.Z,{value:12},"МСК+9 (камчатское время)"))),n.createElement(te.Z,null,"Максимальная яркость:",n.createElement(w.Z,{component:"span",color:u.brightness>184?"error":"initial"}," ",u.brightness)),n.createElement(U.Z,null,n.createElement(M.Z,{container:!0,spacing:2,alignItems:"center"},n.createElement(M.Z,{item:!0,className:l.icon},n.createElement(B.Z,null)),n.createElement(M.Z,{item:!0,xs:!0},n.createElement(_.Z,{min:72,max:255,marks:[{value:184,label:"Предел БП"}],value:u.brightness,onChange:(e,t)=>{d({...u,brightness:t}),a(v)}})),n.createElement(M.Z,{item:!0,className:l.icon},n.createElement(R.Z,null))))):null),n.createElement(we,null),n.createElement(ce.Z,{open:i,onClose:o},n.createElement(ue.Z,null,"Внимание!"),n.createElement(me.Z,null,n.createElement(oe.Z,null,"Для применения настроек светильник необходимо перезагрузить вручную. Отключите светильник от сети и после перезагрузки заново подключитесь к светильнику в приложении.")),n.createElement(ie.Z,null,n.createElement(se.Z,{onClick:o,color:"primary"},"ОК"))))}const Ce=(0,r.Z)((e=>({backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},offset:{paddingBottom:e.mixins.toolbar.minHeight}}))),ke=function(){const e=Ce(),t=(0,s.Z)("(prefers-color-scheme: dark)"),a=(0,n.useMemo)((()=>(0,c.Z)({palette:{primary:{main:t?"#FFCD14":"#F55528"},secondary:{main:t?"#0AAAD7":"#008CC3"},type:t?"dark":"light"}},m.nx)),[t]),l=["Эффекты","Будильник","Настройки"],[r,f]=(0,n.useState)(!1),[h,b]=(0,n.useState)(null),[w,y]=(0,n.useState)({address:"",valid:!1}),[x,C]=(0,n.useState)(),[k,z]=(0,n.useState)(null),S=(0,n.useMemo)((()=>function(e,t){const a=async(t=(()=>localStorage.getItem("lamp-ip"))(),a)=>{const n=new AbortController,l=setTimeout((()=>n.abort()),5e3);e(!0);try{const r=await fetch("http://".concat(t,"/"),{signal:n.signal,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await r.json()}finally{clearTimeout(l),e(!1)}};return Object.fromEntries(Object.entries(v).map((([e,t])=>[e,t.bind(null,a)])))}(f)),[]);return(0,n.useEffect)((()=>{if(void 0===x&&!w.address&&null===h){const e=localStorage.getItem("lamp-ip");e?y({address:e,valid:!0}):C(!1)}void 0===x&&w.address&&(async()=>{await S.ping(w.address)?(localStorage.setItem("lamp-ip",w.address),C(!0)):C(!1)})(),!0===x&&null===h&&b(0),!1===x&&2!==h&&b(2)}),[S,x,w.address,h]),n.createElement(i.Z,{theme:a},n.createElement(E.ZP,null),n.createElement(p.Z,{disableGutters:!0,maxWidth:"sm"},n.createElement(Z.Provider,{value:[x,C]},n.createElement(N,{title:l[h],save:k}),n.createElement(u.Z,{className:e.offset},n.createElement(g.Provider,{value:S},0===h?n.createElement(q,null):1===h?n.createElement(re,{setSave:z}):2===h?n.createElement(xe,{ip:w,setIp:y,setSave:z}):null)),n.createElement(O,{labels:l,page:h,setPage:b}))),n.createElement(o.Z,{className:e.backdrop,open:r},n.createElement(d.Z,{color:"inherit"})))};l.render(n.createElement(ke),document.getElementById("app"))}},0,[[3658,666,216],[7956,666,216]]]);