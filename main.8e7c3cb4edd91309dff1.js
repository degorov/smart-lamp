(self.webpackChunksmart_lamp=self.webpackChunksmart_lamp||[]).push([[179],{4397:(e,t,a)=>{"use strict";var l=a(7294),n=a(9060),r=a(1120),s=a(3457),c=a(8129),i=a(1579),o=a(6159),m=a(9702),u=a(7748),d=a(5477),E=a(3832),p=a(5834);const Z=(0,l.createContext)();Z.displayName="ConnectionContext";const g=(0,l.createContext)();g.displayName="ApiContext";const v={ping:async function(e,t){try{return"OK"===(await e(t,{action:"ping"})).error}catch(e){return!1}}};var h=a(5258),f=a(7812),w=a(8358),b=a(2318),C=a(3375),y=a(739),k=a(5403);const x=(0,r.Z)((e=>({title:{flexGrow:1},save:{marginRight:e.spacing(2)}})));function S({title:e,save:t}){const a=x(),[n]=(0,l.useContext)(Z);return l.createElement(h.Z,{position:"sticky"},l.createElement(w.Z,null,l.createElement(b.Z,{variant:"h6",className:a.title},e||"Светильник"),t?l.createElement(f.Z,{className:a.save,color:"inherit",onClick:t},l.createElement(C.Z,null)):null,n?l.createElement(k.Z,null):l.createElement(y.Z,null)))}var P=a(5881),z=a(8665),N=a(1076),I=a(2832),F=a(9956);const A=(0,r.Z)((e=>({root:{width:"100%",maxWidth:e.breakpoints.values.sm,position:"fixed",bottom:0,zIndex:100}})));function L({page:e,labels:t,setPage:a}){const n=A(),[r]=(0,l.useContext)(Z);return l.createElement(P.Z,{className:n.root,showLabels:!0,value:e,onChange:(e,t)=>{a(t)}},l.createElement(z.Z,{label:t[0],icon:l.createElement(F.Z,null),disabled:!r}),l.createElement(z.Z,{label:t[1],icon:l.createElement(N.Z,null),disabled:!r}),l.createElement(z.Z,{label:t[2],icon:l.createElement(I.Z,null)}))}function W(){const[,e]=(0,l.useContext)(Z);return l.createElement("p",null,"Эффекты")}var O=a(3258),T=a(2822),_=a(998),j=a(6869),D=a(1860),G=a(5757),M=a(6837),$=a(9570),B=a(6183);const H=(0,r.Z)((e=>({alarmField:{background:e.palette.background.paper,width:150},timeField:{background:e.palette.background.paper,width:75}})));function R({setSave:e}){const t=H(),[,a]=(0,l.useContext)(Z),n=(0,l.useContext)(g),[r,s]=(0,l.useState)({enabled:!1,time:"",repeat:0,before:0,after:0}),c=(0,l.useCallback)((async()=>{await n.ping(localStorage.getItem("lamp-ip"))||a(!1)}),[n,a]);return(0,l.useEffect)((()=>(window.addEventListener("focus",c),c(),()=>{window.removeEventListener("focus",c),e(null)})),[c,e]),l.createElement(T.Z,null,l.createElement(_.Z,null,l.createElement(j.Z,null,l.createElement(N.Z,null)),l.createElement(G.Z,{primary:"Будильник включен"}),l.createElement(D.Z,null,l.createElement($.Z,{color:"primary",edge:"end",checked:!0,onChange:()=>{}}))),l.createElement(_.Z,null,l.createElement(G.Z,{inset:!0,primary:"Время:"}),l.createElement(B.Z,{id:"alarm-time",type:"time",variant:"outlined",size:"small",className:t.alarmField,inputProps:{step:300},value:"",onChange:e=>{}})),l.createElement(M.Z,null,"Повторять по:"),["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"].map(((e,t)=>l.createElement(_.Z,{dense:!0,button:!0,key:t,onClick:()=>{}},l.createElement(j.Z,null,l.createElement(O.Z,{color:"primary",edge:"start",checked:!0,disableRipple:!0})),l.createElement(G.Z,{primary:e})))),l.createElement(M.Z,null,"Настройки рассвета (в минутах):"),l.createElement(_.Z,null,l.createElement(G.Z,{primary:"Рассвет до будильника:"}),l.createElement(D.Z,null,l.createElement(B.Z,{id:"time-before",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))),l.createElement(_.Z,null,l.createElement(G.Z,{primary:"Гореть после будильника:"}),l.createElement(D.Z,null,l.createElement(B.Z,{id:"time-after",size:"small",variant:"outlined",className:t.timeField,inputProps:{maxLength:2},value:"",onChange:e=>{}}))))}var J=a(282),K=a(4436),q=a(1749),Q=a(7397),U=a(3700),V=a(5639),X=a(6718),Y=a(4845),ee=a(7816),te=a(5352),ae=a(7802),le=a(67),ne=a(8270),re=a(9659);function se(){return l.createElement(u.Z,{textAlign:"center",p:2},l.createElement("div",null,l.createElement(re.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://github.com/degorov/smart-lamp"},"Репозиторий проекта на GitHub")),l.createElement("div",null,"Application icon made by ",l.createElement(re.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.freepik.com"},"Freepik")," from ",l.createElement(re.Z,{target:"_blank",rel:"noreferrer",underline:"always",href:"https://www.flaticon.com/"},"www.flaticon.com")))}const ce=(0,r.Z)((e=>({root:{backgroundColor:e.palette.background.paper},icon:{marginTop:"-20px"}})));function ie({ip:e,setIp:t,setSave:a}){const n=ce(),[r,s]=(0,l.useContext)(Z),c=(0,l.useContext)(g),[i,o]=(0,l.useState)({ssid:"Smart-Lamp",password:"",showPassword:!1,timezone:3,brightness:192}),m=e=>t=>{o({...i,[e]:t.target.value}),a(d)},u=(0,l.useCallback)((async()=>{r&&(await c.ping(localStorage.getItem("lamp-ip"))||s(!1))}),[c,r,s]),d=()=>async()=>{await c.ping(localStorage.getItem("lamp-ip"))||s(!1),a(null)};return(0,l.useEffect)((()=>(window.addEventListener("focus",u),u(),()=>{window.removeEventListener("focus",u),a(null)})),[u,a]),l.createElement(l.Fragment,null,l.createElement(T.Z,{className:n.root},l.createElement(M.Z,null,"Подключение:"),l.createElement(_.Z,null,l.createElement(B.Z,{id:"lamp-ip",label:"IP-адрес лампы",variant:"outlined",size:"small",value:e.address,onChange:e=>{const a=e.target.value;/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/.test(a)?t({address:a,valid:!0}):t({address:a,valid:!1})},error:!e.valid}),l.createElement(D.Z,null,l.createElement(J.Z,{variant:"contained",color:"primary",disabled:!e.valid,onClick:()=>s()},l.createElement(ae.Z,null)))),r?l.createElement(l.Fragment,null,l.createElement(_.Z,null,l.createElement(B.Z,{id:"ssid",label:"Имя сети",variant:"outlined",size:"small",fullWidth:!0,value:i.ssid,onChange:m("ssid")})),l.createElement(_.Z,null,l.createElement(K.Z,{variant:"outlined",size:"small",fullWidth:!0},l.createElement(U.Z,{htmlFor:"password"},"Пароль сети"),l.createElement(X.Z,{id:"password",labelWidth:95,type:i.showPassword?"text":"password",value:i.password,onChange:m("password"),endAdornment:l.createElement(Q.Z,{position:"end"},l.createElement(f.Z,{onClick:()=>{o({...i,showPassword:!i.showPassword})},onMouseDown:e=>{e.preventDefault()},edge:"end"},i.showPassword?l.createElement(le.Z,null):l.createElement(ne.Z,null)))}))),l.createElement(M.Z,null,"Часовой пояс:"),l.createElement(_.Z,null,l.createElement(B.Z,{id:"timezone",select:!0,variant:"outlined",size:"small",fullWidth:!0,value:i.timezone,onChange:m("timezone")},l.createElement(V.Z,{value:2},"МСК−1 (калининградское время)"),l.createElement(V.Z,{value:3},"МСК (московское время)"),l.createElement(V.Z,{value:4},"МСК+1 (самарское время)"),l.createElement(V.Z,{value:5},"МСК+2 (екатеринбургское время)"),l.createElement(V.Z,{value:6},"МСК+3 (омское время)"),l.createElement(V.Z,{value:7},"МСК+4 (красноярское время)"),l.createElement(V.Z,{value:8},"МСК+5 (иркутское время)"),l.createElement(V.Z,{value:9},"МСК+6 (якутское время)"),l.createElement(V.Z,{value:10},"МСК+7 (владивостокское время)"),l.createElement(V.Z,{value:11},"МСК+8 (магаданское время)"),l.createElement(V.Z,{value:12},"МСК+9 (камчатское время)"))),l.createElement(M.Z,null,"Максимальная яркость:",l.createElement(b.Z,{component:"span",color:i.brightness>192?"error":"initial"}," ",i.brightness)),l.createElement(_.Z,null,l.createElement(q.Z,{container:!0,spacing:2,alignItems:"center"},l.createElement(q.Z,{item:!0,className:n.icon},l.createElement(te.Z,null)),l.createElement(q.Z,{item:!0,xs:!0},l.createElement(Y.Z,{min:0,max:255,marks:[{value:192,label:"Предел БП"}],value:i.brightness,onChange:(e,t)=>{o({...i,brightness:t}),a(d)}})),l.createElement(q.Z,{item:!0,className:n.icon},l.createElement(ee.Z,null))))):null),l.createElement(se,null))}const oe=(0,r.Z)((e=>({backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},offset:{paddingBottom:e.mixins.toolbar.minHeight}}))),me=function(){const e=oe(),t=(0,s.Z)("(prefers-color-scheme: dark)"),a=(0,l.useMemo)((()=>(0,c.Z)({palette:{primary:{main:t?"#FFCD14":"#F55528"},secondary:{main:t?"#0AAAD7":"#008CC3"},type:t?"dark":"light"}},o.nx)),[t]),n=["Эффекты","Будильник","Настройки"],[r,h]=(0,l.useState)(!1),[f,w]=(0,l.useState)(null),[b,C]=(0,l.useState)({address:"",valid:!1}),[y,k]=(0,l.useState)(),[x,P]=(0,l.useState)(null),z=(0,l.useMemo)((()=>function(e){const t=async(t,a)=>{const l=new AbortController,n=setTimeout((()=>l.abort()),3e3);e(!0);try{const r=await fetch("http://".concat(t,"/"),{signal:l.signal,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await r.json()}finally{clearTimeout(n),e(!1)}};return Object.fromEntries(Object.entries(v).map((([e,a])=>[e,a.bind(null,t)])))}(h)),[]);return(0,l.useEffect)((()=>{if(void 0===y&&!b.address&&null===f){const e=localStorage.getItem("lamp-ip");e?C({address:e,valid:!0}):k(!1)}void 0===y&&b.address&&(async()=>{await z.ping(b.address)?(localStorage.setItem("lamp-ip",b.address),k(!0)):k(!1)})(),!0===y&&null===f&&w(0),!1===y&&2!==f&&w(2)}),[z,y,b.address,f]),l.createElement(i.Z,{theme:a},l.createElement(p.ZP,null),l.createElement(E.Z,{disableGutters:!0,maxWidth:"sm"},l.createElement(Z.Provider,{value:[y,k]},l.createElement(S,{title:n[f],save:x}),l.createElement(u.Z,{className:e.offset},l.createElement(g.Provider,{value:z},0===f?l.createElement(W,null):1===f?l.createElement(R,{setSave:P}):2===f?l.createElement(ie,{ip:b,setIp:C,setSave:P}):null)),l.createElement(L,{labels:n,page:f,setPage:w}))),l.createElement(m.Z,{className:e.backdrop,open:r},l.createElement(d.Z,{color:"inherit"})))};n.render(l.createElement(me),document.getElementById("app"))}},0,[[3658,666,216],[4397,666,216]]]);